<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>TatvaBot ‚Äî Gardening Assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --green:#14532d;
  --accent:#16a34a;
  --bg:#f7f7f8;
  --bubble:#f1f5f9;
}

body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.chat-wrapper{
  width:100%;
  max-width:900px;
  height:85vh;
  background:white;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

.chat-header{
  background:var(--green);
  color:white;
  padding:12px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.chat-body{
  flex:1;
  padding:16px;
  overflow-y:auto;
  background:#fafafa;
}

.msg{
  max-width:75%;
  margin-bottom:14px;
}

.msg.user{ margin-left:auto; text-align:right; }
.msg span{
  display:inline-block;
  padding:10px 14px;
  border-radius:12px;
  background:var(--bubble);
}
.msg.user span{
  background:var(--green);
  color:white;
}

.meta{
  font-size:11px;
  color:#777;
  margin-top:4px;
}

.chat-footer{
  display:flex;
  gap:8px;
  padding:12px;
  border-top:1px solid #ddd;
}

.chat-footer input{
  flex:1;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid #ccc;
}

.send{
  background:var(--accent);
  color:white;
  border:none;
  padding:10px 18px;
  border-radius:999px;
  cursor:pointer;
}

.mic, .file{
  border:1px solid #ccc;
  background:white;
  border-radius:50%;
  width:40px;
  height:40px;
  cursor:pointer;
}

.quick-row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-bottom:12px;
}

.quick-btn{
  padding:6px 12px;
  border-radius:999px;
  border:1px solid #ccc;
  background:white;
  cursor:pointer;
  font-size:13px;
}
</style>
</head>

<body>

<div class="chat-wrapper">

  <div class="chat-header">
    <div>
      <strong>TatvaBot ‚Äî Gardening Assistant</strong><br>
      <small>Your AI plant doctor</small>
    </div>
    <div id="location">üìç Location: not set</div>
  </div>

  <div class="chat-body" id="chat"></div>

  <div class="chat-footer">
    <input id="input" placeholder="Type or speak..." />
    <button class="mic" id="mic">üé§</button>
    <label class="file">üìé
      <input type="file" id="image" hidden accept="image/*">
    </label>
    <button class="send" id="send">Send</button>
  </div>

</div>

<script>
/* ---------------- CORE CHAT ---------------- */

const chat = document.getElementById("chat");
const input = document.getElementById("input");

function time(){
  return new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
}

function addMessage(text, who="bot"){
  const div = document.createElement("div");
  div.className = "msg " + (who==="user"?"user":"");
  div.innerHTML = <span>${text}</span><div class="meta">${time()}</div>;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ---------------- QUICK DIAG BUTTONS ---------------- */

const DIAG_TOPICS = {
  A:"Yellow Leaves", B:"Curling Leaves", C:"Indoor Plants Dying",
  D:"White Fungus", F:"Leaf Holes", G:"Slow Growth",
  I:"Pest Attack", J:"Root Rot"
};

function showQuickButtons(){
  const row = document.createElement("div");
  row.className="quick-row";
  Object.entries(DIAG_TOPICS).forEach(([k,v])=>{
    const b=document.createElement("button");
    b.className="quick-btn";
    b.textContent=v;
    b.onclick=()=>startDiagnosis(k);
    row.appendChild(b);
  });
  chat.appendChild(row);
}

addMessage("Hi üëã I can diagnose plant problems.");
showQuickButtons();

/* ---------------- DIAGNOSIS ENGINE ---------------- */

const QUESTIONS = {
  A:["Soft or crispy leaves?","Watering frequency?","Direct sunlight?","Old or new leaves?"],
  B:["Curl direction?","Sunlight hours?","Any pests?","Since when?"],
  C:["Light amount?","Fertilizer use?","Soil wet long?","Ventilation?"],
  D:["Powdery or cotton?","Soil wet?","Sticky leaves?","Black spots?"],
  F:["Hole shape?","Insects seen?","Indoor/outdoor?","New leaves affected?"],
  G:["Fertilizer frequency?","Enough light?","Pot small?","Pests?"],
  I:["Which pest?","Sticky residue?","Under leaves?","New soil?"],
  J:["Foul smell?","Drainage holes?","Leaves drooping?","Soil wet long?"]
};

let diagActive=false, diagKey="", step=0, answers=[];

function startDiagnosis(key){
  diagActive=true; diagKey=key; step=0; answers=[];
  addMessage(ü©∫ Starting diagnosis: <b>${DIAG_TOPICS[key]}</b>);
  askNext();
}

function askNext(){
  addMessage(Step ${step+1}/4 ‚Äî ${QUESTIONS[diagKey][step]});
}

function finishDiagnosis(){
  addMessage("üìã Diagnosis summary ready.");
  generateTreatment();
  diagActive=false;
}

function generateTreatment(){
  addMessage("üåø Treatment plan generated. Upload image for accuracy.");
}

/* ---------------- SEND MESSAGE ---------------- */

function sendMessage(){
  const text=input.value.trim();
  if(!text) return;
  addMessage(text,"user");
  input.value="";

  if(diagActive){
    answers.push(text);
    if(step<3){ step++; askNext(); }
    else finishDiagnosis();
  }else{
    addMessage("Thanks! Use diagnosis buttons for plant issues.");
  }
}

document.getElementById("send").onclick=sendMessage;

/* ---------------- VOICE ---------------- */

if('webkitSpeechRecognition'in window){
  const rec=new webkitSpeechRecognition();
  rec.lang="en-IN";
  document.getElementById("mic").onclick=()=>{
    rec.start();
  };
  rec.onresult=e=>{
    input.value=e.results[0][0].transcript;
  };
}

/* ---------------- IMAGE ---------------- */

document.getElementById("image").onchange=e=>{
  if(e.target.files[0]){
    addMessage("üì∑ Image received. Analysis coming soon.");
  }
};
</script>

</body>
</html>
